<!DOCTYPE html>
<html ng-app="newsApp">
  <head>
    <meta charset="utf-8">
    <title>News Feed</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.min.js"></script>
    <script>
      //  localStorage.clear();
  
      let newsApp = angular.module('newsApp', ['ngRoute']);

      newsApp.config(function($routeProvider) {
        $routeProvider.
          when('/', {
            templateUrl: 'newsFeed.html',
            controller: 'NewsCtrl'
          }).
          when('/addnew', {
            templateUrl: 'addNews.html',
            controller: 'NewsCtrl'
          }).
          when('/edit',{
            templateUrl: 'editNewsFeed.html',
            controller: "NewsCtrl"
          }).
          otherwise({
            redirectTo: '/'
          });
      });    
        
      newsApp.controller('NewsCtrl', function ($scope){
        $scope.newsFeed = JSON.parse(localStorage.getItem("news"));
        
        
        $scope.removeNews = function(n) {
          let i = $scope.newsFeed.indexOf(n);
          let newNews = JSON.parse(localStorage.getItem("news"));
          newNews.splice(i, 1);
          localStorage.setItem("news", JSON.stringify(newNews));
          $scope.newsFeed = JSON.parse(localStorage.getItem("news"));

        };

        $scope.addingNews = function() {
          if (localStorage.length ===0) {
            localStorage.setItem("news", JSON.stringify([]));
          }
          let newOne = JSON.parse(localStorage.getItem("news"));
          newOne.push({
            title: $scope.enteredTitle,
            url: $scope.enteredUrl+"",
            description: $scope.enteredDesc 
          });
          localStorage.setItem("news", JSON.stringify(newOne));
          $scope.newsFeed = JSON.parse(localStorage.getItem("news"));
          
        };

        $scope.editPageInit = function(n){
          let index = $scope.newsFeed.indexOf(n);
          localStorage.setItem("edit", JSON.stringify([n.title, n.url, n.description, index]));
          localStorage.setItem("editInit", true);
        }

        $scope.$watch('JSON.parse(localStorage.getItem("edit"))', function(){
          if(localStorage.getItem("editInit")){
           $scope.newTitle = JSON.parse(localStorage.getItem('edit'))[0];
           $scope.newUrl = JSON.parse(localStorage.getItem('edit'))[1];
          $scope.newDesc = JSON.parse(localStorage.getItem('edit'))[2];
          }
        });
        
        
        

        $scope.editingNews = function(){
          let newOne = JSON.parse(localStorage.getItem("news"));
          let index = JSON.parse(localStorage.getItem("edit"))[3];
          newOne[index].title = $scope.newTitle;
          newOne[index].url = $scope.newUrl+"";
          newOne[index].description = $scope.newDesc;
          localStorage.setItem("news", JSON.stringify(newOne));
          $scope.newsFeed = JSON.parse(localStorage.getItem("news"));
        }


      });
    </script>
  </head>
  <body>
    <div ng-view></div>
  </body>
</html>